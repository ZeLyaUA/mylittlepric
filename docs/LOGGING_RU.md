# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—é –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω)

```bash
docker-compose -f docker-compose.monitoring.yml up -d
```

### 2. –û—Ç–∫—Ä–æ–π—Ç–µ Grafana

- URL: http://localhost:3001
- –õ–æ–≥–∏–Ω: `admin`
- –ü–∞—Ä–æ–ª—å: `admin`

### 3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Explore

1. –í –ª–µ–≤–æ–º –º–µ–Ω—é –≤—ã–±–µ—Ä–∏—Ç–µ **Explore** (–∏–∫–æ–Ω–∫–∞ –∫–æ–º–ø–∞—Å–∞)
2. –í –≤—ã–ø–∞–¥–∞—é—â–µ–º —Å–ø–∏—Å–∫–µ –≤—ã–±–µ—Ä–∏—Ç–µ **Loki**

## –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ù–∞–π—Ç–∏ –≤—Å–µ –ª–æ–≥–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–µ—Å—Å–∏–∏

```logql
{compose_service="mylittleprice-backend"}
  | json
  | session_id = "–í–ê–®–ê_SESSION_ID"
```

**–ö–∞–∫ –Ω–∞–π—Ç–∏ session_id:**
- –û—Ç–∫—Ä–æ–π—Ç–µ DevTools –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
- Console ‚Üí –≤—ã–ø–æ–ª–Ω–∏—Ç–µ: `localStorage.getItem('chat-storage')`
- –ù–∞–π–¥–∏—Ç–µ –ø–æ–ª–µ `sessionId`

### –û—Ç—Å–ª–µ–¥–∏—Ç—å –ø–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ —á–µ—Ä–µ–∑ SERP API

```logql
{compose_service="mylittleprice-backend"}
  | json
  | session_id = "–í–ê–®–ê_SESSION_ID"
  |~ "SERP"
```

**–ß—Ç–æ –≤—ã —É–≤–∏–¥–∏—Ç–µ:**
- üîç –ò–Ω–∏—Ü–∏–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (–∑–∞–ø—Ä–æ—Å, —Å—Ç—Ä–∞–Ω–∞, —Ü–µ–Ω—ã)
- ‚è±Ô∏è –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –æ—Ç SERP API
- üì¶ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤
- ‚úÖ –£—Å–ø–µ—à–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å —Ç–æ–ø-3 —Ç–æ–≤–∞—Ä–∞–º–∏
- ‚ùå –û—à–∏–±–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–∞–∫–∏–µ —Ç–æ–≤–∞—Ä—ã –±—ã–ª–∏ –Ω–∞–π–¥–µ–Ω—ã

```logql
{compose_service="mylittleprice-backend"}
  |= "SERP search completed successfully"
  | json
  | session_id = "–í–ê–®–ê_SESSION_ID"
```

**–í—ã–≤–æ–¥ –ø–æ–∫–∞–∂–µ—Ç:**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ (`product_count`)
- –û—Ü–µ–Ω–∫—É —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ (`relevance_score`)
- –ù–∞–∑–≤–∞–Ω–∏—è —Ç–æ–ø-3 —Ç–æ–≤–∞—Ä–æ–≤ (`top_products`)

### –ù–∞–π—Ç–∏ –æ—à–∏–±–∫–∏ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ

```logql
{compose_service="mylittleprice-backend"}
  | json
  | level = "ERROR"
  | session_id = "–í–ê–®–ê_SESSION_ID"
```

## –ü—Ä–∏–º–µ—Ä—ã —Ä–µ–∞–ª—å–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### "–ü–æ—á–µ–º—É –Ω–µ –≤–µ—Ä–Ω—É–ª–∏—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞?"

```logql
{compose_service="mylittleprice-backend"}
  | json
  | session_id = "abc-123"
  |~ "No relevant products|SERP search completed"
```

**–ê–Ω–∞–ª–∏–∑:**
- –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ "No relevant products" - —Ç–æ–≤–∞—Ä—ã –±—ã–ª–∏ –Ω–∞–π–¥–µ–Ω—ã, –Ω–æ –Ω–µ –ø—Ä–æ—à–ª–∏ —Ñ–∏–ª—å—Ç—Ä —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `relevance_score` - –Ω–∏–∑–∫–∏–π score (<0.3) –æ–∑–Ω–∞—á–∞–µ—Ç –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å `query` - –≤–æ–∑–º–æ–∂–Ω–æ, –æ–Ω –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π

### "–ü–æ—á–µ–º—É –ø–æ–∏—Å–∫ –º–µ–¥–ª–µ–Ω–Ω—ã–π?"

```logql
{compose_service="mylittleprice-backend"}
  |= "SERP response received"
  | json
  | session_id = "abc-123"
  | line_format "{{.query}}: {{.duration_seconds}}s (key {{.key_index}})"
```

**–ê–Ω–∞–ª–∏–∑:**
- –ù–æ—Ä–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è: 1-3 —Å–µ–∫—É–Ω–¥—ã
- –ú–µ–¥–ª–µ–Ω–Ω–æ: >3 —Å–µ–∫—É–Ω–¥
- –ï—Å–ª–∏ –µ—Å—Ç—å retry (attempt > 1) - –±—ã–ª–∞ –æ—à–∏–±–∫–∞ —Å–µ—Ç–∏ –∏–ª–∏ quota

### "–ö–∞–∫–æ–π API –∫–ª—é—á –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è?"

```logql
{compose_service="mylittleprice-backend"}
  |= "SERP response received"
  | json
  | session_id = "abc-123"
  | line_format "Key: {{.key_index}}, Duration: {{.duration_seconds}}s"
```

### "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å quota –æ—à–∏–±–∫–∏"

```logql
{compose_service="mylittleprice-backend"}
  |= "Quota error detected"
  | json
```

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
- Quota error –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ API –∫–ª—é—á –∏—Å—á–µ—Ä–ø–∞–ª –ª–∏–º–∏—Ç
- –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –∫–ª—é—á
- –î–æ–±–∞–≤—å—Ç–µ –±–æ–ª—å—à–µ –∫–ª—é—á–µ–π –≤ `SERP_API_KEYS` (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)

## –§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤

### –£—Å–ø–µ—à–Ω—ã–π –ø–æ–∏—Å–∫

```
üîç SERP search initiated
   query: "iphone 15 pro"
   search_type: "exact"
   country: "US"
   language: "en"
   min_price: 500
   max_price: 1500
   session_id: "abc-123"
   user_id: "user-456"

‚è±Ô∏è SERP response received
   duration_seconds: 1.23
   key_index: 0

üì¶ Raw SERP results received
   product_count: 15

‚úÖ SERP search completed successfully
   product_count: 10
   relevance_score: 0.92
   top_products: ["iPhone 15 Pro 256GB", "iPhone 15 Pro Max", ...]
```

### –û—à–∏–±–∫–∞

```
‚ùå SERP API error
   error: "quota exceeded"
   duration_seconds: 0.5
   attempt: 1
   max_attempts: 4
   key_index: 2

‚ö†Ô∏è Quota error detected, marking key as exhausted
   key_index: 2

üîÑ SERP retry with next key
   attempt: 2
```

## –ü–æ–ª–µ–∑–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã

### –¢–æ–ª—å–∫–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
```logql
| level = "INFO"
```

### –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
```logql
| level = "ERROR"
```

### –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É
```logql
|= "–∏—Å–∫–æ–º—ã–π —Ç–µ–∫—Å—Ç"
```

### –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ
```logql
|~ "SERP (search|error|response)"
```

### –ò—Å–∫–ª—é—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è
```logql
!= "metrics requested"
```

### –î–∏–∞–ø–∞–∑–æ–Ω –∑–Ω–∞—á–µ–Ω–∏–π
```logql
| duration_seconds > 2
```

## Live —Ä–µ–∂–∏–º (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏)

1. –í Grafana –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **Live** –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É
2. –í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è –≤–∞—à–µ–π —Å–µ—Å—Å–∏–∏
3. –í—ã–ø–æ–ª–Ω—è–π—Ç–µ –¥–µ–π—Å—Ç–≤–∏—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ - –ª–æ–≥–∏ –ø–æ—è–≤—è—Ç—Å—è —Å—Ä–∞–∑—É

**–ü–æ–ª–µ–∑–Ω–æ –¥–ª—è:**
- –û—Ç–ª–∞–¥–∫–∏ –ø—Ä—è–º–æ –≤–æ –≤—Ä–µ–º—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –ü—Ä–æ—Å–º–æ—Ç—Ä–∞ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ performance –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

## –≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤

1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–ø—Ä–æ—Å
2. –ù–∞–∂–º–∏—Ç–µ **Inspector** ‚Üí **Data**
3. –í—ã–±–µ—Ä–∏—Ç–µ **Download CSV** –∏–ª–∏ **Download JSON**

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è:**
- –ê–Ω–∞–ª–∏–∑–∞ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- –°–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á–µ—Ç–æ–≤ –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–≥–æ–≤ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

## –°–æ–≤–µ—Ç—ã

### üéØ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞

1. **–ù–∞—á–Ω–∏—Ç–µ —Å session_id** - —ç—Ç–æ —Å–≤—è–∑—ã–≤–∞–µ—Ç –≤—Å–µ –ª–æ–≥–∏ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ time range** - —Å—É–∂–∞–π—Ç–µ –¥–∏–∞–ø–∞–∑–æ–Ω –≤—Ä–µ–º–µ–Ω–∏ (Last 15 minutes, Last 1 hour)
3. **–§–∏–ª—å—Ç—Ä—É–π—Ç–µ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ** - —Å–Ω–∞—á–∞–ª–∞ session, –ø–æ—Ç–æ–º level, –ø–æ—Ç–æ–º —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
4. **Live mode** - –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### üìä –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º

1. –ù–∞–π–¥–∏—Ç–µ ERROR –ª–æ–≥–∏ –¥–ª—è —Å–µ—Å—Å–∏–∏
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ INFO –ª–æ–≥–∏ - —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –¥–æ –æ—à–∏–±–∫–∏
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ duration_seconds - –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ attempt > 1 - –±—ã–ª–∏ retry

### üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```logql
{compose_service="mylittleprice-backend"}
  | json
  | user_id = "–í–ê–®_USER_ID"
```

**–ü–æ–ª–µ–∑–Ω–æ –¥–ª—è:**
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤—Å–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü–æ–Ω–∏–º–∞–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ user journey
- –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

–í `.env` —Ñ–∞–π–ª–µ:
```env
LOG_LEVEL=info          # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
LOG_LEVEL=debug         # –û—á–µ–Ω—å –ø–æ–¥—Ä–æ–±–Ω–æ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
LOG_LEVEL=warn          # –¢–æ–ª—å–∫–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –æ—à–∏–±–∫–∏
LOG_LEVEL=error         # –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
```

### –§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤

```env
LOG_FORMAT=json         # –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON (–¥–ª—è Loki)
LOG_FORMAT=text         # –¢–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç (–¥–ª—è —á—Ç–µ–Ω–∏—è —á–µ–ª–æ–≤–µ–∫–æ–º)
```

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ query –ø—Ä–∏–º–µ—Ä–æ–≤: [grafana/loki-queries.md](../grafana/loki-queries.md)
- LogQL –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://grafana.com/docs/loki/latest/logql/
- –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ: [LOGGING.md](./LOGGING.md)
